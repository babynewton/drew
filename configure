#!/bin/bash

MK=Makefile
MK_IN=$MK.in

LIBLUA=lua5.1

PREFIX=/usr/local
INST_BIN=/bin

DEVS="liblua5.1-0-dev "
DEPENDS="liblua5.1-0 libgtk2.0-0"

function config_tools(){
	GTK_DEV=`apt-cache search libgtk2.0-0-dev`
	if [ -n "$GTK_DEV" ]
	then
		DEVS+="libgtk2.0-0-dev"
	else
		DEVS+="libgtk2.0-dev"
	fi
	for DEV in $DEVS
	do
		EXISTS=`dpkg -l | grep $DEV`
		if [ ! -n "$EXISTS" ]
		then
			echo installing $DEV
			sudo apt-get install $DEV
		else
			echo $DEV exists. skip....
		fi
	done
}

function init_lua(){
	SCRIPT_INCS=`pkg-config --cflags lua5.1`
	echo lua includes : $SCRIPT_INCS
	SCRIPT_LIBSS=`pkg-config --libs lua5.1`
	echo lua libraries : $SCRIPT_LIBSS
}

function init_gtk(){
	UI_INCS=`pkg-config --cflags gtk+-2.0`
	echo gtk includes : $UI_INCS
	UI_LIBS=`pkg-config --libs gtk+-2.0`
	echo gtk libraries : $UI_LIBS
}

function config_runner(){
	sed "s#@script_libs@#$SCRIPT_LIBSS#g;
		s#@root@#$PREFIX#g;
		s#@bin@#$INST_BIN#g;
		s#@ui_libs@#$UI_LIBS#g"< runner/$MK_IN > runner/$MK
	echo "runner:$MK_IN ==> $MK"
}

function config_script(){
	sed "s#@script_incs@#$SCRIPT_INCS#g" < script/$MK_IN > script/$MK
	echo "engine:$MK_IN ==> $MK"
}

function config_engine(){
	sed "s#@ui_incs@#-I$UI_INCS#g" < engine/$MK_IN > engine/$MK
	echo "engine:$MK_IN ==> $MK"
}

function config_main(){
	echo "$MK_IN ==> $MK"
	cp $MK_IN $MK
}

config_tools

for DIR in dml utility
do
	cd $DIR
	echo "$DIR:$MK_IN ==> $MK"
	cp $MK_IN $MK
	cd ..
done

init_lua
init_gtk
config_runner
config_engine
config_script
config_main
